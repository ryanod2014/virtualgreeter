{
  "id": "BLOCKED-TKT-042-1",
  "type": "blocker",
  "source": "dev-agent-TKT-042",
  "severity": "critical",
  "title": "Should rate limiting use Redis or in-memory store?",
  "feature": "API Rate Limiting",
  "category": "clarification",
  "status": "pending",
  "found_at": "2025-12-05T02:30:00Z",
  
  "issue": "The ticket says to implement rate limiting but doesn't specify the storage backend. We're running multiple server instances behind a load balancer, so in-memory rate limiting won't work correctly (each instance would have its own counter). However, adding Redis adds infrastructure complexity. Need guidance on which approach to use.",
  
  "options": [
    {
      "id": 1,
      "label": "In-memory with sticky sessions — Use in-memory Map but configure load balancer for sticky sessions. Simpler but ties users to specific instances.",
      "recommended": false
    },
    {
      "id": 2,
      "label": "Redis-backed — Use Redis for distributed rate limit counters. Works across all instances but requires Redis to be available.",
      "recommended": true
    },
    {
      "id": 3,
      "label": "Hybrid approach — Start with in-memory, fall back gracefully if Redis unavailable. More complex but resilient.",
      "recommended": false
    }
  ],
  
  "recommendation": "Option 2 because we already have Redis configured for session storage, so no new infrastructure needed. Distributed counters ensure accurate rate limiting across all instances.",
  
  "blocker_context": {
    "ticket_id": "TKT-042",
    "ticket_version": 1,
    "branch": "agent/tkt-042-rate-limiting",
    "progress": {
      "commits": [
        "f8a2c1d - TKT-042: Add rate limiter middleware skeleton",
        "b3e9f7a - TKT-042: Create RateLimiter interface and types"
      ],
      "done": [
        "Created middleware skeleton",
        "Defined RateLimiter interface",
        "Added configuration types"
      ],
      "remaining": [
        "Implement storage backend ← BLOCKED HERE",
        "Wire up to API routes",
        "Add tests",
        "Update documentation"
      ],
      "stopped_at": {
        "file": "apps/server/src/middleware/rate-limiter.ts",
        "line": 45,
        "context": "About to implement the storage.increment() method"
      },
      "notes_for_next_agent": "The RateLimiter interface is ready, just need to implement the concrete storage class based on the decision."
    }
  }
}
