# TKT-077: Improve Error Message for Catch-All Pool Routing Rules

## Status: COMPLETE

## Summary

Improved the user experience when attempting to add or modify routing rules on catch-all pools by:

1. **Displaying user-friendly error messages** instead of silent `console.warn()` calls
2. **Catching database trigger errors** that prevent routing rules on catch-all pools
3. **Providing clear, actionable guidance** to users

## Changes Made

### File: `apps/dashboard/src/app/(app)/admin/pools/pools-client.tsx`

#### `handleAddRoutingRule` function (lines 1785-1838)
- Changed `console.warn()` to `alert()` with user-friendly message
- Added error handling for database insert errors
- Detects catch-all pool errors by checking for "catch-all" or "catch_all" in error message
- Shows generic error message for other database failures

#### `handleUpdateRoutingRule` function (lines 1855-1904)
- Same improvements as above for consistency
- Changed `console.warn()` to `alert()` with user-friendly message
- Added error handling for database update errors

### Error Message Displayed

> "Routing rules cannot be added to the catch-all pool. This pool automatically receives all visitors not matched by other rules."

## Acceptance Criteria

- [x] Error message is clear and actionable
- [x] User understands why operation failed
- [x] F-108 is resolved

## Notes

### Pre-existing Codebase Issues

The `pnpm typecheck` and `pnpm build` commands fail due to pre-existing issues in the codebase (not related to this ticket):

1. **Merge conflict markers** in:
   - `apps/dashboard/src/features/cobrowse/CobrowseViewer.tsx`
   - `apps/dashboard/src/features/surveys/ellis-survey-modal.tsx`
   - `apps/dashboard/src/app/(app)/platform/feedback/page.tsx`
   - `apps/widget/src/features/webrtc/useWebRTC.test.ts`

2. The changes in this ticket are syntactically correct and follow existing patterns in the codebase.

### UI Already Handles Catch-All Pools

The "Add Rule" button is already hidden for catch-all pools in the UI (lines 2201-2232 of `pools-client.tsx`). Instead, users see an informational box explaining:
- "This pool automatically receives all visitors that don't match any other pool's routing rules"
- "No Rules Allowed" badge
- Option to create a new pool instead

The error handling added in this ticket provides defense-in-depth for edge cases where:
1. The client-side `is_catch_all` state is stale
2. Direct API calls bypass the UI

## Branch

`agent/tkt-077`

## Commit

`230f324` - TKT-077: Improve error message for catch-all pool routing rules
