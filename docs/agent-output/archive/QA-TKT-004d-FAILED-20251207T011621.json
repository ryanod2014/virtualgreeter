{
  "ticket_id": "TKT-004d",
  "ticket_title": "Widget and Agent Status for Paused Orgs",
  "branch": "agent/tkt-004d-paused-org-status",
  "blocked_at": "2025-12-07T01:45:00Z",
  "blocker_type": "qa_failure",
  "summary": "AC2 not implemented - no mechanism to force agents offline when org pauses",
  "failures": [
    {
      "category": "acceptance",
      "criterion": "AC2: All agents forced to 'offline' status when org pauses",
      "expected": "When org transitions to 'paused' status, all agents belonging to that org should be automatically forced offline, their visitors reassigned, and active calls ended gracefully",
      "actual": "No implementation found. Code only prevents agents from GOING available (AC3) but does not force currently-available agents offline when pause event occurs. Agents remain available and serving visitors after org is paused.",
      "evidence": "Searched codebase for force-offline logic in:\n- Stripe webhook handlers (apps/server/src/features/webhooks/stripe.ts)\n- Admin pause actions (apps/dashboard/src/app/(dashboard)/settings/actions.ts)\n- Organization utilities (apps/server/src/lib/organization.ts)\n- Agent status management (apps/server/src/features/agents/agentStatus.ts)\nNO force-offline mechanism found in any of these locations."
    },
    {
      "category": "acceptance",
      "criterion": "Test coverage for agent status and org pause logic",
      "expected": "Unit tests for agentStatus.ts, organization.ts, and widget pause behavior",
      "actual": "No test files exist for new modules. agentStatus.test.ts not found. organization.test.ts not found.",
      "evidence": "Attempted to run: pnpm test agentStatus\nResult: 'No test files found, exiting with code 1'"
    },
    {
      "category": "build",
      "criterion": "Type definitions complete",
      "expected": "OrgPausedPayload type defined in @ghost-greeter/domain package",
      "actual": "Widget imports OrgPausedPayload but type definition not found in domain package",
      "evidence": "Widget.tsx line 7 imports 'OrgPausedPayload' from domain, but grep search found no definition"
    }
  ],
  "recommendation": "Create continuation ticket TKT-004d-CONTINUATION to implement missing AC2 functionality:\n1. Add force-offline handler when org status changes to 'paused'\n2. Integrate with Stripe subscription.paused webhook\n3. Integrate with admin pause action\n4. Force all org agents offline, reassign visitors, end calls\n5. Add comprehensive test coverage for all pause/resume flows\n6. Add OrgPausedPayload type definition to domain package",
  "dispatch_action": "create_continuation_ticket",
  "severity": "critical",
  "completion_percentage": 75,
  "working_acs": ["AC1", "AC3", "AC4"],
  "broken_acs": ["AC2"],
  "requires_retest": true
}
