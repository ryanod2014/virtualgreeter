{
  "ticket_id": "TKT-014",
  "ticket_title": "Recording Consent Indicator for Visitors",
  "branch": "agent/tkt-014",
  "blocked_at": "2025-12-07T03:30:00Z",
  "blocker_type": "qa_failure",
  "summary": "Critical security regression: sensitive data masking removed from co-browse feature (out of scope)",
  "failures": [
    {
      "category": "security",
      "criterion": "Out-of-scope changes",
      "expected": "Only recording badge files should be modified",
      "actual": "Branch removes maskSensitiveFields() from cobrowse, exposing passwords/PII",
      "evidence": "git diff shows removal of maskSensitiveFields import and function call from apps/widget/src/features/cobrowse/useCobrowse.ts"
    },
    {
      "category": "scope",
      "criterion": "Files within files_to_modify list",
      "expected": "Changes limited to: CallUI.tsx, RecordingBadge.tsx, widget-styles.ts, and related integration files",
      "actual": "Branch includes out-of-scope changes to cobrowse security features",
      "evidence": "apps/widget/src/features/cobrowse/useCobrowse.ts modified but not in ticket scope"
    },
    {
      "category": "browser",
      "criterion": "Mandatory browser testing per SOP",
      "expected": "Browser tests with Playwright MCP, screenshots, edge case testing",
      "actual": "Browser testing blocked by pre-existing build failures",
      "evidence": "pnpm build fails on server package (pre-existing), pnpm dev cannot start"
    }
  ],
  "security_impact": {
    "severity": "CRITICAL",
    "vulnerability_type": "Sensitive Data Exposure",
    "affected_feature": "Co-browse DOM snapshot transmission",
    "data_exposed": [
      "Passwords (input[type='password'])",
      "Credit card numbers",
      "SSNs and other PII",
      "Any sensitive form fields"
    ],
    "compliance_risk": [
      "GDPR Article 32 - Security of processing",
      "CCPA - Reasonable security procedures",
      "PCI-DSS Requirement 3 - Protect stored cardholder data"
    ]
  },
  "recording_badge_status": {
    "implementation": "EXCELLENT",
    "acceptance_criteria": "ALL 4 PASSED (code verified)",
    "code_quality": "Production-ready",
    "note": "The recording badge itself is correct and well-implemented"
  },
  "recommendation": "Create continuation ticket to cherry-pick only recording badge commits, excluding cobrowse changes",
  "continuation_ticket_requirements": {
    "branch_strategy": "Create new branch from main, cherry-pick only recording badge commits",
    "files_to_include": [
      "packages/domain/src/types.ts",
      "apps/server/src/lib/call-settings.ts",
      "apps/server/src/features/signaling/socket-handlers.ts",
      "apps/server/src/features/signaling/redis-socket-handlers.ts",
      "apps/widget/src/features/call/RecordingBadge.tsx",
      "apps/widget/src/features/call/CallUI.tsx",
      "apps/widget/src/widget-styles.ts",
      "apps/widget/src/features/webrtc/LiveCallView.tsx",
      "apps/widget/src/Widget.tsx"
    ],
    "files_to_exclude": [
      "apps/widget/src/features/cobrowse/useCobrowse.ts",
      "apps/widget/src/features/cobrowse/domSerializer.ts"
    ],
    "additional_tasks": [
      "Verify cobrowse maskSensitiveFields is intact on new branch",
      "Run security scan on co-browse feature",
      "Complete browser testing with Playwright MCP when build issues resolved",
      "Take required screenshots for documentation"
    ]
  },
  "dispatch_action": "create_continuation_ticket",
  "priority": "CRITICAL",
  "blocks_merge": true
}
