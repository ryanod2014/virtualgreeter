<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PM Dashboard ‚Ä¢ Digital Greeter</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-base: #050508;
      --bg-surface: #0c0c12;
      --bg-elevated: #141420;
      --bg-hover: #1c1c2a;
      --text-primary: #f4f4f8;
      --text-secondary: #9090a8;
      --text-muted: #5a5a70;
      --border: #252538;
      --border-subtle: #1a1a28;
      --critical: #ef4444;
      --critical-bg: rgba(239,68,68,0.12);
      --high: #f97316;
      --high-bg: rgba(249,115,22,0.12);
      --medium: #eab308;
      --medium-bg: rgba(234,179,8,0.12);
      --low: #22c55e;
      --low-bg: rgba(34,197,94,0.12);
      --accent: #6366f1;
      --accent-bright: #818cf8;
      --accent-bg: rgba(99,102,241,0.12);
      --success: #10b981;
      --gradient-hero: linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #ec4899 100%);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-base);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    code, .mono { font-family: 'IBM Plex Mono', monospace; }
    ::selection { background: var(--accent); color: white; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-surface); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.3s ease; }
    .slide-up { animation: slideUp 0.4s ease; }

    /* Nav */
    .nav { display: flex; gap: 4px; background: var(--bg-surface); padding: 6px; border-radius: 12px; border: 1px solid var(--border); }
    .nav-item { padding: 12px 20px; border: none; background: transparent; color: var(--text-muted); cursor: pointer; border-radius: 8px; font-size: 14px; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
    .nav-item:hover { color: var(--text-secondary); background: var(--bg-elevated); }
    .nav-item.active { background: var(--accent-bg); color: var(--accent-bright); }

    /* Tabs */
    .tabs { display: flex; gap: 4px; background: var(--bg-surface); padding: 4px; border-radius: 10px; border: 1px solid var(--border); width: fit-content; }
    .tab { padding: 8px 16px; border: none; background: transparent; color: var(--text-muted); cursor: pointer; border-radius: 6px; font-size: 13px; font-weight: 500; transition: all 0.2s; }
    .tab:hover { color: var(--text-secondary); }
    .tab.active { background: var(--accent-bg); color: var(--accent-bright); }
    .tab .count { margin-left: 6px; padding: 2px 6px; background: var(--bg-elevated); border-radius: 8px; font-size: 11px; }

    /* Cards */
    .card { background: var(--bg-surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
    .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    
    /* Badges */
    .badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
    .badge-critical { color: var(--critical); background: var(--critical-bg); }
    .badge-high { color: var(--high); background: var(--high-bg); }
    .badge-medium { color: var(--medium); background: var(--medium-bg); }
    .badge-low { color: var(--low); background: var(--low-bg); }
    .badge-pending { color: var(--accent-bright); background: var(--accent-bg); }
    .badge-resolved { color: var(--success); background: rgba(16,185,129,0.12); }

    /* Pipeline Card */
    .pipeline-card { flex: 1; min-width: 160px; }
    .pipeline-card .inner { background: var(--bg-surface); border: 1px solid var(--border); border-radius: 16px; padding: 20px; height: 100%; position: relative; overflow: hidden; }
    .pipeline-card.complete .inner::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--success); }
    .pipeline-card .icon { font-size: 18px; margin-right: 8px; }
    .pipeline-card .label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 600; }
    .pipeline-card .value { font-size: 36px; font-weight: 800; font-family: 'IBM Plex Mono', monospace; margin: 12px 0; }
    .pipeline-card .value span { font-size: 20px; color: var(--text-muted); }
    .pipeline-card .subtitle { font-size: 12px; color: var(--text-muted); }
    .pipeline-card .bar { height: 4px; background: var(--bg-elevated); border-radius: 2px; margin: 12px 0 8px; overflow: hidden; }
    .pipeline-card .bar-fill { height: 100%; background: var(--gradient-hero); transition: width 0.5s ease; }
    .pipeline-card.complete .bar-fill { background: var(--success); }

    /* Thread */
    .thread { background: var(--bg-elevated); border-radius: 8px; padding: 16px; margin-top: 12px; }
    .message { padding: 10px 14px; border-radius: 8px; margin-bottom: 8px; max-width: 85%; }
    .message-system { background: var(--bg-surface); border: 1px solid var(--border); margin-right: auto; }
    .message-human { background: var(--accent-bg); border: 1px solid rgba(99,102,241,0.3); margin-left: auto; text-align: right; }

    /* Inputs */
    .input-group { display: flex; gap: 8px; margin-top: 12px; }
    .input { flex: 1; padding: 10px 14px; background: var(--bg-base); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px; font-family: inherit; }
    .input:focus { outline: none; border-color: var(--accent); }
    .btn { padding: 10px 18px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { background: var(--accent-bright); }
    .btn-secondary { background: var(--bg-elevated); color: var(--text-secondary); border: 1px solid var(--border); }
    .btn-success { background: var(--success); color: white; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }

    /* Quick answers */
    .quick-answers { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px; }
    .quick-btn { padding: 6px 12px; background: var(--bg-surface); border: 1px solid var(--border); border-radius: 6px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.2s; }
    .quick-btn:hover { border-color: var(--accent); color: var(--accent-bright); }

    /* Ticket Grid */
    .ticket-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }
    .ticket-card { background: var(--bg-surface); border: 1px solid var(--border); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.2s; border-left: 3px solid var(--border); }
    .ticket-card:hover { background: var(--bg-elevated); }
    .ticket-card.priority-critical { border-left-color: var(--critical); }
    .ticket-card.priority-high { border-left-color: var(--high); }
    .ticket-card.priority-medium { border-left-color: var(--medium); }
    .ticket-card.priority-low { border-left-color: var(--low); }

    /* Command Box */
    .command-box { background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 8px; padding: 16px; position: relative; }
    .command-box pre { background: var(--bg-base); padding: 14px; border-radius: 6px; font-size: 12px; overflow-x: auto; white-space: pre-wrap; margin: 0; }
    .command-box .copy-btn { position: absolute; top: 24px; right: 24px; }

    /* Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 40px; backdrop-filter: blur(4px); }
    .modal { background: var(--bg-surface); border: 1px solid var(--border); border-radius: 16px; max-width: 800px; width: 100%; max-height: 85vh; overflow: auto; }
    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: var(--bg-surface); z-index: 10; }
    .modal-body { padding: 24px; }

    /* Section */
    .section { margin-bottom: 32px; }
    .section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; margin-bottom: 16px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ================= DATA =================
    const FINDINGS_SUMMARY = {
      "meta": { "total_features": 61, "reviewed_features": 61, "total_findings": 742 },
      "by_priority": {
        "critical": { "total": 15, "answered": 15, "tickets_created": 7, "pending": 0 },
        "high": { "total": 48, "answered": 20, "tickets_created": 12, "pending": 28 },
        "medium": { "total": 315, "answered": 2, "tickets_created": 2, "pending": 313 },
        "low": { "total": 364, "answered": 2, "tickets_created": 2, "pending": 362 }
      }
    };

    const TICKETS_DATA = [
      { id: "TKT-001", title: "Co-Browse Sensitive Data Sanitization", priority: "critical", feature: "Co-Browse", status: "ready", difficulty: "medium", files: ["domSerializer.ts", "cobrowseSender.ts", "CobrowseViewer.tsx"], acceptance_criteria: ["Password masked", "CC masked", "data-sensitive masked", "Unit tests"], risk_notes: ["Regex too aggressive", "Bypass risk"], issue: "Password fields and credit card numbers are captured in DOM snapshots." },
      { id: "TKT-002", title: "Complete Stripe Subscription Cancellation", priority: "critical", feature: "Billing", status: "ready", difficulty: "medium", files: ["settings/actions.ts", "stripe.ts", "webhooks/stripe.ts"], acceptance_criteria: ["Stripe API called", "Access until period end", "Webhook handler"], issue: "Cancellation only updates DB, doesn't call Stripe API." },
      { id: "TKT-003", title: "Update Cancellation Data Deletion Copy", priority: "critical", feature: "Billing", status: "ready", difficulty: "easy", files: ["CancelModal.tsx"], acceptance_criteria: ["Updated copy", "No immediate deletion mention"], issue: "Modal says 'permanently deleted' but data isn't actually deleted." },
      { id: "TKT-004", title: "Complete Pause Subscription with Stripe", priority: "critical", feature: "Billing", status: "ready", difficulty: "hard", files: ["settings/actions.ts", "stripe.ts", "webhooks/stripe.ts", "scheduler/"], acceptance_criteria: ["Stripe pause", "Auto-resume", "Widget disabled"], issue: "Pause updates DB but doesn't stop Stripe billing." },
      { id: "TKT-005", title: "Payment Failure Blocking + Retry UI", priority: "critical", feature: "Billing", status: "ready", difficulty: "hard", files: ["PaymentBlocker.tsx", "layout.tsx", "webhooks/stripe.ts", "email.ts"], acceptance_criteria: ["past_due status", "Block modal", "Email notification", "Agents offline"], issue: "No feedback when payment fails - account keeps working." },
      { id: "TKT-006", title: "Fix Middleware Redirect", priority: "critical", feature: "Auth", status: "ready", difficulty: "easy", files: ["middleware.ts"], acceptance_criteria: ["Redirect to /login", "No loops"], issue: "Protected routes return blank instead of redirecting." },
      { id: "TKT-017", title: "Enforce Pool Routing on Reassignment", priority: "critical", feature: "Routing", status: "ready", difficulty: "medium", files: ["reassignVisitors.ts", "agentSelection.ts"], acceptance_criteria: ["Pool ID passed", "Stay in pool"], issue: "Reassignment ignores pool - crosses pool boundaries." },
      { id: "TKT-009", title: "Org-Level Co-Browse Disable", priority: "high", feature: "Co-Browse", status: "ready", difficulty: "medium", files: ["settings/page.tsx", "settings/actions.ts", "cobrowseSender.ts"], acceptance_criteria: ["Settings toggle", "Disable works"], issue: "No way to disable co-browse for GDPR." },
      { id: "TKT-011", title: "Email Invite Retry Mechanism", priority: "high", feature: "Agent Mgmt", status: "ready", difficulty: "medium", files: ["agents/actions.ts", "email.ts"], acceptance_criteria: ["Auto-retry", "Status visible", "Resend button"], issue: "Email failures are silent - invites stuck." },
      { id: "TKT-012", title: "Migrate Geolocation to MaxMind", priority: "high", feature: "Blocklist", status: "ready", difficulty: "medium", files: ["geolocation.ts", "checkVisitor.ts"], acceptance_criteria: ["MaxMind API", "Rate limit OK"], issue: "ip-api.com rate limit fails at scale." },
    ];

    // Findings will be loaded from server or embedded fallback
    let FINDINGS_DATA = [];

    const PM_COMMANDS = {
      docMode: {
        label: "üìù Launch Doc Sprint",
        command: "You are the PM. Read and execute docs/workflow/PM_DOCS_SOP.md - Doc Mode.\n\nGenerate launch commands for all undocumented features.",
        description: "PM reads inventory, creates prompts, outputs batch of doc-agent commands"
      },
      reviewMode: {
        label: "üîç Launch Review Sprint", 
        command: "You are the PM. Read and execute docs/workflow/PM_DOCS_SOP.md - Review Mode.\n\nGenerate launch commands for all documented features that need review.",
        description: "PM reads tracker, creates prompts, outputs batch of review-agent commands"
      },
      processDecisions: {
        label: "üé´ Process Triage Decisions",
        command: "You are the PM. Read docs/data/decisions.json and:\n1. For each 'resolved' finding, create ticket in tickets.json\n2. For 'in_discussion' findings, add follow-up questions to decisions.json\n3. Update findings.json status to 'ticketed'\n4. Run: node docs/scripts/generate-pm-dashboard.js",
        description: "Creates tickets from your resolved findings"
      },
      continueHighFindings: {
        label: "üìã Continue High Priority Triage",
        command: "You are the PM. Continue processing High priority findings.\n\nRead docs/REVIEW_FINDINGS.md and present the next batch of 10 High priority findings with questions.",
        description: "Continue triaging remaining High priority findings"
      }
    };

    // ================= COMPONENTS =================

    function Badge({ type, children }) {
      return <span className={`badge badge-${type}`}>{children}</span>;
    }

    function PipelineCard({ icon, label, current, total, subtitle, complete }) {
      const pct = total > 0 ? Math.round((current / total) * 100) : 0;
      return (
        <div className={`pipeline-card ${complete ? 'complete' : ''}`}>
          <div className="inner">
            <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
              <span className="icon">{icon}</span>
              <span className="label">{label}</span>
            </div>
            <div className="value" style={{ color: complete ? 'var(--success)' : 'var(--text-primary)' }}>
              {current}<span>/{total}</span>
            </div>
            <div className="bar"><div className="bar-fill" style={{ width: `${pct}%` }} /></div>
            <div className="subtitle">{subtitle}</div>
          </div>
        </div>
      );
    }

    function TicketCard({ ticket, onClick }) {
      return (
        <div className={`ticket-card priority-${ticket.priority}`} onClick={onClick}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
            <code style={{ fontSize: '12px', color: 'var(--text-muted)' }}>{ticket.id}</code>
            <div style={{ display: 'flex', gap: '6px' }}>
              <Badge type={ticket.priority}>{ticket.priority}</Badge>
              <Badge type={ticket.difficulty === 'easy' ? 'low' : ticket.difficulty === 'hard' ? 'critical' : 'medium'}>{ticket.difficulty}</Badge>
            </div>
          </div>
          <h3 style={{ fontSize: '14px', fontWeight: 600, marginBottom: '6px' }}>{ticket.title}</h3>
          <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '8px' }}>{ticket.feature}</div>
          <div style={{ fontSize: '11px', color: 'var(--text-secondary)' }}>üìÅ {ticket.files.length} files ‚Ä¢ ‚úì {ticket.acceptance_criteria.length} criteria</div>
        </div>
      );
    }

    function TicketModal({ ticket, onClose }) {
      if (!ticket) return null;
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal fade-in" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <div>
                <code style={{ color: 'var(--text-muted)' }}>{ticket.id}</code>
                <h2 style={{ fontSize: '18px', fontWeight: 600, marginTop: '4px' }}>{ticket.title}</h2>
              </div>
              <button className="btn btn-sm btn-secondary" onClick={onClose}>√ó</button>
            </div>
            <div className="modal-body">
              <div className="section">
                <div className="section-title">Issue</div>
                <p style={{ color: 'var(--text-secondary)' }}>{ticket.issue}</p>
              </div>
              <div className="section">
                <div className="section-title">Files to Edit</div>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                  {ticket.files.map((f, i) => <code key={i} style={{ padding: '6px 10px', background: 'var(--bg-elevated)', borderRadius: '6px', fontSize: '12px', color: 'var(--accent-bright)' }}>{f}</code>)}
                </div>
              </div>
              <div className="section">
                <div className="section-title">Acceptance Criteria</div>
                {ticket.acceptance_criteria.map((c, i) => (
                  <div key={i} style={{ padding: '10px 12px', background: 'var(--bg-elevated)', borderRadius: '6px', marginBottom: '6px', fontSize: '13px' }}>‚òê {c}</div>
                ))}
              </div>
              {ticket.risk_notes && (
                <div style={{ padding: '16px', background: 'var(--critical-bg)', borderRadius: '8px', border: '1px solid rgba(239,68,68,0.2)' }}>
                  <div style={{ fontSize: '12px', color: 'var(--critical)', fontWeight: 600, marginBottom: '8px' }}>‚ö†Ô∏è Risk Notes</div>
                  {ticket.risk_notes.map((n, i) => <div key={i} style={{ fontSize: '13px', marginBottom: '4px' }}>‚Ä¢ {n}</div>)}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    function FindingCard({ finding, thread, onSelectOption, onCustomResponse, onResolve, onCombine }) {
      const [customInput, setCustomInput] = useState('');
      const [showCustom, setShowCustom] = useState(false);
      const isResolved = thread?.status === 'resolved';
      const hasDecision = thread?.decision?.option_id;
      const options = finding.options || [];
      const recommendedOption = options.find(o => o.recommended);
      const combinable = finding.combinable_with;

      const handleCustomSubmit = () => {
        if (customInput.trim()) {
          onCustomResponse(finding.id, customInput);
          setCustomInput('');
          setShowCustom(false);
        }
      };

      return (
        <div className="card slide-up" style={{ marginBottom: '16px' }}>
          {/* Header */}
          <div className="card-header">
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <code style={{ color: 'var(--text-muted)', fontSize: '12px' }}>{finding.id}</code>
                {finding.category && <span style={{ fontSize: '10px', color: 'var(--text-muted)', background: 'var(--bg-elevated)', padding: '2px 6px', borderRadius: '4px' }}>{finding.category}</span>}
              </div>
              <h3 style={{ fontSize: '15px', fontWeight: 600, marginTop: '6px' }}>{finding.title}</h3>
              <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginTop: '4px' }}>{finding.feature}</div>
            </div>
            <div style={{ display: 'flex', gap: '6px', flexShrink: 0 }}>
              <Badge type={finding.severity}>{finding.severity}</Badge>
              <Badge type={isResolved ? 'resolved' : hasDecision ? 'pending' : 'pending'}>{isResolved ? '‚úì Done' : hasDecision ? '‚è≥ Ready' : '‚óã Pending'}</Badge>
            </div>
          </div>

          {/* Issue */}
          <p style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '12px', lineHeight: '1.6' }}>{finding.issue}</p>
          
          {/* Suggested Fix */}
          <div style={{ fontSize: '12px', padding: '12px 14px', background: 'var(--bg-elevated)', borderRadius: '8px', marginBottom: '12px', borderLeft: '3px solid var(--accent)' }}>
            <span style={{ color: 'var(--accent-bright)', fontWeight: 600 }}>üí° Suggested Fix:</span>
            <span style={{ color: 'var(--text-secondary)', marginLeft: '8px' }}>{finding.suggested_fix}</span>
          </div>

          {/* Combinable Findings Alert */}
          {combinable && combinable.length > 0 && (
            <div style={{ fontSize: '12px', padding: '12px 14px', background: 'rgba(234,179,8,0.1)', borderRadius: '8px', marginBottom: '12px', border: '1px solid rgba(234,179,8,0.2)' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div>
                  <span style={{ color: 'var(--medium)', fontWeight: 600 }}>üîó Related Findings:</span>
                  <span style={{ color: 'var(--text-secondary)', marginLeft: '6px' }}>
                    {combinable.map(c => `${c.id}: ${c.title}`).join(', ')}
                  </span>
                </div>
                <button
                  onClick={() => onCombine(finding.id, combinable.map(c => c.id))}
                  style={{
                    padding: '6px 12px',
                    background: 'var(--medium)',
                    border: 'none',
                    borderRadius: '6px',
                    color: 'black',
                    fontSize: '12px',
                    fontWeight: 600,
                    cursor: 'pointer',
                    whiteSpace: 'nowrap'
                  }}
                >
                  Combine into 1 ticket ‚Üí
                </button>
              </div>
              <div style={{ fontSize: '11px', color: 'var(--text-muted)', marginTop: '6px' }}>
                Category: {combinable[0]?.group?.replace(/_/g, ' ')}
              </div>
            </div>
          )}

          {/* Decision Area */}
          <div style={{ background: 'var(--bg-elevated)', borderRadius: '10px', padding: '16px', marginTop: '8px' }}>
            <div style={{ fontSize: '11px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '12px' }}>
              {isResolved ? '‚úì Decision Made' : 'Choose Action'}
            </div>

            {/* Show conversation if any */}
            {thread?.messages?.length > 0 && (
              <div style={{ marginBottom: '12px' }}>
                {thread.messages.map((msg, i) => (
                  <div key={i} className={`message message-${msg.role}`} style={{ marginBottom: '6px' }}>
                    <div style={{ fontSize: '10px', color: 'var(--text-muted)', marginBottom: '2px' }}>{msg.role === 'system' ? 'ü§ñ PM' : 'üë§ You'}</div>
                    {msg.text}
                  </div>
                ))}
              </div>
            )}

            {!isResolved && (
              <>
                {/* Option Buttons */}
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '12px' }}>
                  {options.map(opt => (
                    <button
                      key={opt.id}
                      onClick={() => onSelectOption(finding.id, opt)}
                      style={{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between',
                        padding: '12px 16px',
                        background: hasDecision && thread?.decision?.option_id === opt.id ? 'var(--accent-bg)' : 'var(--bg-surface)',
                        border: opt.recommended ? '2px solid var(--accent)' : '1px solid var(--border)',
                        borderRadius: '8px',
                        color: 'var(--text-primary)',
                        fontSize: '13px',
                        cursor: 'pointer',
                        textAlign: 'left',
                        transition: 'all 0.2s'
                      }}
                      onMouseOver={e => e.currentTarget.style.background = 'var(--bg-hover)'}
                      onMouseOut={e => e.currentTarget.style.background = hasDecision && thread?.decision?.option_id === opt.id ? 'var(--accent-bg)' : 'var(--bg-surface)'}
                    >
                      <span style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                        {hasDecision && thread?.decision?.option_id === opt.id ? '‚úì' : '‚óã'}
                        <span>{opt.label}</span>
                      </span>
                      {opt.recommended && (
                        <span style={{ fontSize: '10px', padding: '3px 8px', background: 'var(--accent)', color: 'white', borderRadius: '4px', fontWeight: 600 }}>
                          RECOMMENDED
                        </span>
                      )}
                    </button>
                  ))}
                </div>

                {/* Custom Response */}
                {!showCustom ? (
                  <button 
                    onClick={() => setShowCustom(true)}
                    style={{ fontSize: '12px', color: 'var(--text-muted)', background: 'none', border: 'none', cursor: 'pointer', padding: '4px 0' }}
                  >
                    üí¨ Need a different option? Add custom response...
                  </button>
                ) : (
                  <div style={{ marginTop: '8px' }}>
                    <textarea
                      value={customInput}
                      onChange={e => setCustomInput(e.target.value)}
                      placeholder="Describe your preferred approach or ask a question..."
                      style={{
                        width: '100%',
                        padding: '10px 12px',
                        background: 'var(--bg-base)',
                        border: '1px solid var(--border)',
                        borderRadius: '6px',
                        color: 'var(--text-primary)',
                        fontSize: '13px',
                        fontFamily: 'inherit',
                        resize: 'vertical',
                        minHeight: '60px'
                      }}
                    />
                    <div style={{ display: 'flex', gap: '8px', marginTop: '8px' }}>
                      <button className="btn btn-primary btn-sm" onClick={handleCustomSubmit}>üí¨ Send to PM</button>
                      <button className="btn btn-secondary btn-sm" onClick={() => setShowCustom(false)}>Cancel</button>
                    </div>
                  </div>
                )}

                {/* Resolve Button - only show for actual decisions, not questions */}
                {hasDecision && thread?.decision?.option_id !== 'custom' && (
                  <div style={{ marginTop: '12px', paddingTop: '12px', borderTop: '1px solid var(--border)' }}>
                    <button className="btn btn-success" onClick={() => onResolve(finding.id)}>
                      ‚úì Confirm & Create Ticket
                    </button>
                  </div>
                )}
                
                {/* For custom responses (questions), show waiting state */}
                {hasDecision && thread?.decision?.option_id === 'custom' && (
                  <div style={{ marginTop: '12px', paddingTop: '12px', borderTop: '1px solid var(--border)', padding: '12px', background: 'rgba(99,102,241,0.1)', borderRadius: '6px' }}>
                    <div style={{ fontSize: '13px', color: 'var(--accent-bright)' }}>
                      üí¨ Question sent! PM will respond in this thread.
                    </div>
                    <div style={{ fontSize: '11px', color: 'var(--text-muted)', marginTop: '4px' }}>
                      Tell PM in Cursor: "check my answers" ‚Üí then refresh this page
                    </div>
                  </div>
                )}
              </>
            )}

            {/* Resolved State */}
            {isResolved && (
              <div style={{ padding: '12px', background: 'rgba(16,185,129,0.1)', borderRadius: '6px', fontSize: '13px' }}>
                <div style={{ color: 'var(--success)', fontWeight: 600, marginBottom: '4px' }}>‚úì {thread?.decision?.option_label || 'Decision recorded'}</div>
                {thread?.decision?.combined_with && (
                  <div style={{ color: 'var(--text-secondary)', fontSize: '12px', marginTop: '4px' }}>
                    üîó Combined with: {thread.decision.combined_with.join(', ')}
                  </div>
                )}
                {thread?.decision?.custom_note && (
                  <div style={{ color: 'var(--text-secondary)', fontSize: '12px', marginTop: '4px' }}>Note: {thread.decision.custom_note}</div>
                )}
              </div>
            )}
            
            {/* Combined but not yet resolved */}
            {!isResolved && thread?.decision?.combined_with && (
              <div style={{ padding: '12px', background: 'rgba(234,179,8,0.1)', borderRadius: '6px', fontSize: '13px', marginTop: '12px' }}>
                <div style={{ color: 'var(--medium)', fontWeight: 600, marginBottom: '4px' }}>
                  üîó {thread?.decision?.is_primary ? 'Primary finding' : 'Will be combined with'}: {thread?.decision?.is_primary ? thread.decision.combined_with.join(', ') : finding.id}
                </div>
                {thread?.decision?.is_primary && (
                  <button className="btn btn-success btn-sm" style={{ marginTop: '8px' }} onClick={() => onResolve(finding.id)}>
                    ‚úì Confirm Combined Ticket
                  </button>
                )}
              </div>
            )}
          </div>
        </div>
      );
    }

    function CommandBox({ label, command, description }) {
      const [copied, setCopied] = useState(false);
      const copy = () => { navigator.clipboard.writeText(command); setCopied(true); setTimeout(() => setCopied(false), 2000); };
      return (
        <div style={{ marginBottom: '16px' }}>
          <div style={{ fontSize: '13px', fontWeight: 600, marginBottom: '6px' }}>{label}</div>
          {description && <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '8px' }}>{description}</div>}
          <div className="command-box">
            <pre>{command}</pre>
            <button className="btn btn-sm btn-primary copy-btn" onClick={copy}>{copied ? '‚úì Copied!' : 'Copy'}</button>
          </div>
        </div>
      );
    }

    // ================= VIEWS =================

    function PipelineView() {
      const s = FINDINGS_SUMMARY;
      const totalAnswered = Object.values(s.by_priority).reduce((sum, p) => sum + p.answered, 0);
      const totalPending = Object.values(s.by_priority).reduce((sum, p) => sum + p.pending, 0);
      const ticketCount = TICKETS_DATA.length;

      return (
        <div className="fade-in">
          <div className="section">
            <div className="section-title">Pipeline Status</div>
            <div style={{ display: 'flex', gap: '16px', flexWrap: 'wrap' }}>
              <PipelineCard icon="üìù" label="Documented" current={s.meta.total_features} total={s.meta.total_features} subtitle="Features documented" complete={true} />
              <PipelineCard icon="üîç" label="Reviewed" current={s.meta.reviewed_features} total={s.meta.total_features} subtitle="Features reviewed" complete={true} />
              <PipelineCard icon="üìã" label="Triaged" current={totalAnswered} total={s.meta.total_findings} subtitle={`${totalPending} pending`} complete={totalPending === 0} />
              <PipelineCard icon="üé´" label="Ticketed" current={ticketCount} total={ticketCount} subtitle="Ready for dev" complete={true} />
              <PipelineCard icon="üî®" label="In Progress" current={0} total={ticketCount} subtitle="Being developed" complete={false} />
            </div>
          </div>


          <div className="section">
            <div className="section-title">Quick Actions</div>
            <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
              <div className="card" style={{ flex: 1, padding: '16px' }}>
                <div style={{ fontSize: '14px', fontWeight: 600, marginBottom: '8px' }}>üìã Triage Findings</div>
                <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '12px' }}>Answer questions for {totalPending} pending findings</div>
                <button className="btn btn-primary btn-sm">Go to Triage ‚Üí</button>
              </div>
              <div className="card" style={{ flex: 1, padding: '16px' }}>
                <div style={{ fontSize: '14px', fontWeight: 600, marginBottom: '8px' }}>üöÄ Launch Agents</div>
                <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '12px' }}>Get commands for doc/review agents</div>
                <button className="btn btn-secondary btn-sm">Go to Agents ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function TriageView({ serverMode, onSave, findingsData, serverDecisions }) {
      const [severityFilter, setSeverityFilter] = useState('critical');
      const [statusFilter, setStatusFilter] = useState('all');
      const [saveStatus, setSaveStatus] = useState(null);
      const [page, setPage] = useState(0);
      const PAGE_SIZE = 10;
      
      const findings = findingsData || [];

      const [decisions, setDecisions] = useState(() => {
        const saved = localStorage.getItem('pm-decisions-v3');
        if (saved) return JSON.parse(saved);
        return { threads: [] };
      });

      // Merge server decisions (PM responses) into local state
      useEffect(() => {
        if (serverDecisions?.threads) {
          setDecisions(prev => {
            const merged = { ...prev };
            const localThreadMap = new Map(prev.threads.map(t => [t.finding_id, t]));
            
            for (const serverThread of serverDecisions.threads) {
              const localThread = localThreadMap.get(serverThread.finding_id);
              if (localThread) {
                // Merge PM messages (role: system) from server into local
                const localMsgTexts = new Set((localThread.messages || []).map(m => m.text));
                const pmMessages = (serverThread.messages || []).filter(m => m.role === 'system');
                
                for (const pmMsg of pmMessages) {
                  if (!localMsgTexts.has(pmMsg.text)) {
                    localThread.messages = localThread.messages || [];
                    localThread.messages.push(pmMsg);
                    localThread.messages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                  }
                }
              }
            }
            
            return merged;
          });
        }
      }, [serverDecisions]);

      // Initialize threads for new findings
      useEffect(() => {
        if (findings.length > 0) {
          setDecisions(prev => {
            const existingIds = new Set(prev.threads.map(t => t.finding_id));
            const newThreads = findings
              .filter(f => !existingIds.has(f.id))
              .map(f => ({ finding_id: f.id, status: 'pending', messages: [], decision: null }));
            if (newThreads.length === 0) return prev;
            return { ...prev, threads: [...prev.threads, ...newThreads] };
          });
        }
      }, [findings]);

      // Auto-save when decisions change
      useEffect(() => {
        localStorage.setItem('pm-decisions-v3', JSON.stringify(decisions));
        
        if (serverMode && onSave && decisions.threads.length > 0) {
          setSaveStatus('saving');
          onSave(decisions).then(() => {
            setSaveStatus('saved');
            setTimeout(() => setSaveStatus(null), 2000);
          }).catch(() => {
            setSaveStatus('error');
          });
        }
      }, [decisions, serverMode, onSave]);

      const getThread = (id) => decisions.threads.find(t => t.finding_id === id);
      
      const handleSelectOption = (id, option) => {
        setDecisions(prev => ({
          ...prev,
          threads: prev.threads.map(t => {
            if (t.finding_id !== id) return t;
            return {
              ...t,
              status: 'in_discussion',
              decision: {
                option_id: option.id,
                option_label: option.label,
                recommended: option.recommended || false,
                timestamp: new Date().toISOString()
              }
            };
          })
        }));
      };

      const handleCustomResponse = (id, text) => {
        setDecisions(prev => ({
          ...prev,
          threads: prev.threads.map(t => {
            if (t.finding_id !== id) return t;
            return {
              ...t,
              status: 'in_discussion',
              messages: [
                ...t.messages,
                { role: 'human', text, timestamp: new Date().toISOString() }
              ],
              decision: {
                option_id: 'custom',
                option_label: 'Custom response',
                custom_note: text,
                timestamp: new Date().toISOString()
              }
            };
          })
        }));
      };

      const handleResolve = (id) => {
        setDecisions(prev => ({
          ...prev,
          threads: prev.threads.map(t => {
            if (t.finding_id !== id) return t;
            return { ...t, status: 'resolved' };
          })
        }));
      };

      const handleCombine = (primaryId, relatedIds) => {
        const allIds = [primaryId, ...relatedIds];
        const primaryFinding = findings.find(f => f.id === primaryId);
        const relatedFindings = relatedIds.map(id => findings.find(f => f.id === id)).filter(Boolean);
        
        // Create combined decision
        const combinedDecision = {
          option_id: 'combined',
          option_label: `Combined ticket: ${primaryFinding?.title}`,
          combined_with: relatedIds,
          combined_titles: relatedFindings.map(f => f?.title),
          timestamp: new Date().toISOString()
        };

        setDecisions(prev => ({
          ...prev,
          threads: prev.threads.map(t => {
            if (!allIds.includes(t.finding_id)) return t;
            return {
              ...t,
              status: 'in_discussion',
              decision: {
                ...combinedDecision,
                is_primary: t.finding_id === primaryId
              }
            };
          })
        }));
      };

      // Calculate stats
      const stats = useMemo(() => {
        const bySeverity = { critical: 0, high: 0, medium: 0, low: 0 };
        const byStatus = { pending: 0, in_discussion: 0, resolved: 0, ticketed: 0 };
        
        findings.forEach(f => {
          // Only count non-ticketed findings in severity tabs
          if (f.status !== 'ticketed') {
            bySeverity[f.severity] = (bySeverity[f.severity] || 0) + 1;
          }
          
          // Count ticketed separately
          if (f.status === 'ticketed') {
            byStatus.ticketed++;
          } else {
            const thread = getThread(f.id);
            const status = thread?.status || 'pending';
            byStatus[status]++;
          }
        });
        
        return { bySeverity, byStatus };
      }, [findings, decisions]);

      // Filter findings
      const filtered = useMemo(() => {
        return findings.filter(f => {
          // Severity filter
          if (f.severity !== severityFilter) return false;
          
          // Hide already-ticketed findings unless specifically viewing them
          if (f.status === 'ticketed' && statusFilter !== 'ticketed') {
            return false;
          }
          
          // Status filter (uses thread status OR finding status for ticketed)
          if (statusFilter !== 'all') {
            if (statusFilter === 'ticketed') {
              return f.status === 'ticketed';
            }
            const thread = getThread(f.id);
            const status = thread?.status || 'pending';
            if (status !== statusFilter) return false;
          }
          
          return true;
        });
      }, [findings, severityFilter, statusFilter, decisions]);

      // Paginated
      const paginated = filtered.slice(page * PAGE_SIZE, (page + 1) * PAGE_SIZE);
      const totalPages = Math.ceil(filtered.length / PAGE_SIZE);

      return (
        <div className="fade-in">
          {/* Severity Tabs */}
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
            <div className="tabs">
              <button className={`tab ${severityFilter === 'critical' ? 'active' : ''}`} onClick={() => { setSeverityFilter('critical'); setPage(0); }}>
                üî¥ Critical <span className="count">{stats.bySeverity.critical || 0}</span>
              </button>
              <button className={`tab ${severityFilter === 'high' ? 'active' : ''}`} onClick={() => { setSeverityFilter('high'); setPage(0); }}>
                üü† High <span className="count">{stats.bySeverity.high || 0}</span>
              </button>
              <button className={`tab ${severityFilter === 'medium' ? 'active' : ''}`} onClick={() => { setSeverityFilter('medium'); setPage(0); }}>
                üü° Medium <span className="count">{stats.bySeverity.medium || 0}</span>
              </button>
              <button className={`tab ${severityFilter === 'low' ? 'active' : ''}`} onClick={() => { setSeverityFilter('low'); setPage(0); }}>
                üü¢ Low <span className="count">{stats.bySeverity.low || 0}</span>
              </button>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              {serverMode ? (
                <div style={{ 
                  fontSize: '12px', 
                  padding: '6px 12px', 
                  borderRadius: '6px',
                  background: saveStatus === 'saved' ? 'rgba(16,185,129,0.15)' : saveStatus === 'saving' ? 'rgba(99,102,241,0.15)' : saveStatus === 'error' ? 'rgba(239,68,68,0.15)' : 'transparent',
                  color: saveStatus === 'saved' ? 'var(--success)' : saveStatus === 'saving' ? 'var(--accent-bright)' : saveStatus === 'error' ? 'var(--critical)' : 'var(--text-muted)'
                }}>
                  {saveStatus === 'saved' ? '‚úì Auto-saved' : saveStatus === 'saving' ? '‚ü≥ Saving...' : saveStatus === 'error' ? '‚úó Save failed' : 'üíæ Auto-save enabled'}
                </div>
              ) : (
                <button className="btn btn-primary btn-sm" onClick={() => {
                  const json = JSON.stringify(decisions, null, 2);
                  navigator.clipboard.writeText(json);
                  alert('Decisions JSON copied!\n\nTip: Run "node docs/pm-dashboard-ui/server.js" for auto-save!');
                }}>üìã Export</button>
              )}
            </div>
          </div>

          {/* Status Filter */}
          <div style={{ display: 'flex', gap: '8px', marginBottom: '20px' }}>
            <button 
              className={`btn btn-sm ${statusFilter === 'all' ? 'btn-primary' : 'btn-secondary'}`}
              onClick={() => setStatusFilter('all')}
            >All</button>
            <button 
              className={`btn btn-sm ${statusFilter === 'pending' ? 'btn-primary' : 'btn-secondary'}`}
              onClick={() => setStatusFilter('pending')}
            >‚óã Pending ({stats.byStatus.pending})</button>
            <button 
              className={`btn btn-sm ${statusFilter === 'in_discussion' ? 'btn-primary' : 'btn-secondary'}`}
              onClick={() => setStatusFilter('in_discussion')}
            >‚è≥ Ready ({stats.byStatus.in_discussion})</button>
            <button 
              className={`btn btn-sm ${statusFilter === 'resolved' ? 'btn-primary' : 'btn-secondary'}`}
              onClick={() => setStatusFilter('resolved')}
            >‚úì Done ({stats.byStatus.resolved})</button>
            <button 
              className={`btn btn-sm ${statusFilter === 'ticketed' ? 'btn-primary' : 'btn-secondary'}`}
              onClick={() => setStatusFilter('ticketed')}
              style={{ marginLeft: '12px', background: statusFilter === 'ticketed' ? 'var(--success)' : undefined }}
            >üé´ Ticketed ({stats.byStatus.ticketed})</button>
          </div>

          {/* Findings List */}
          {filtered.length === 0 ? (
            <div className="card" style={{ textAlign: 'center', padding: '60px' }}>
              <div style={{ fontSize: '40px', marginBottom: '12px' }}>üìã</div>
              <div style={{ color: 'var(--text-muted)' }}>No {severityFilter} findings {statusFilter !== 'all' ? `with ${statusFilter} status` : ''}</div>
            </div>
          ) : (
            <>
              <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '12px' }}>
                Showing {page * PAGE_SIZE + 1}-{Math.min((page + 1) * PAGE_SIZE, filtered.length)} of {filtered.length} {severityFilter} findings
              </div>
              {paginated.map(f => (
                <FindingCard 
                  key={f.id} 
                  finding={f} 
                  thread={getThread(f.id)} 
                  onSelectOption={handleSelectOption}
                  onCustomResponse={handleCustomResponse}
                  onResolve={handleResolve}
                  onCombine={handleCombine}
                />
              ))}
              
              {/* Pagination */}
              {totalPages > 1 && (
                <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginTop: '24px' }}>
                  <button 
                    className="btn btn-sm btn-secondary" 
                    disabled={page === 0}
                    onClick={() => setPage(p => p - 1)}
                  >‚Üê Previous</button>
                  <span style={{ padding: '6px 12px', color: 'var(--text-muted)', fontSize: '13px' }}>
                    Page {page + 1} of {totalPages}
                  </span>
                  <button 
                    className="btn btn-sm btn-secondary"
                    disabled={page >= totalPages - 1}
                    onClick={() => setPage(p => p + 1)}
                  >Next ‚Üí</button>
                </div>
              )}
            </>
          )}
        </div>
      );
    }

    function TicketsView() {
      const [filter, setFilter] = useState('all');
      const [selectedTicket, setSelectedTicket] = useState(null);

      const stats = useMemo(() => {
        const byP = { critical: 0, high: 0, medium: 0, low: 0 };
        TICKETS_DATA.forEach(t => byP[t.priority]++);
        return byP;
      }, []);

      const filtered = filter === 'all' ? TICKETS_DATA : TICKETS_DATA.filter(t => t.priority === filter);

      return (
        <div className="fade-in">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
            <div className="tabs">
              <button className={`tab ${filter === 'all' ? 'active' : ''}`} onClick={() => setFilter('all')}>All <span className="count">{TICKETS_DATA.length}</span></button>
              <button className={`tab ${filter === 'critical' ? 'active' : ''}`} onClick={() => setFilter('critical')}>üî¥ Critical <span className="count">{stats.critical}</span></button>
              <button className={`tab ${filter === 'high' ? 'active' : ''}`} onClick={() => setFilter('high')}>üü† High <span className="count">{stats.high}</span></button>
              <button className={`tab ${filter === 'medium' ? 'active' : ''}`} onClick={() => setFilter('medium')}>üü° Medium <span className="count">{stats.medium}</span></button>
              <button className={`tab ${filter === 'low' ? 'active' : ''}`} onClick={() => setFilter('low')}>üü¢ Low <span className="count">{stats.low}</span></button>
            </div>
          </div>
          <div className="ticket-grid">
            {filtered.map(t => <TicketCard key={t.id} ticket={t} onClick={() => setSelectedTicket(t)} />)}
          </div>
          {selectedTicket && <TicketModal ticket={selectedTicket} onClose={() => setSelectedTicket(null)} />}
        </div>
      );
    }

    function AgentsView() {
      const s = FINDINGS_SUMMARY;
      const totalPending = Object.values(s.by_priority).reduce((sum, p) => sum + p.pending, 0);
      const highPending = s.by_priority.high.pending;

      return (
        <div className="fade-in">
          {/* Current Status */}
          <div className="section">
            <div className="section-title">Current Status</div>
            <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap', marginBottom: '16px' }}>
              <div className="card" style={{ flex: 1, padding: '16px', textAlign: 'center', minWidth: '140px' }}>
                <div style={{ fontSize: '11px', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '4px' }}>Undocumented</div>
                <div style={{ fontSize: '24px', fontWeight: 700, color: 'var(--success)' }}>0</div>
                <div style={{ fontSize: '11px', color: 'var(--success)' }}>‚úì All done</div>
              </div>
              <div className="card" style={{ flex: 1, padding: '16px', textAlign: 'center', minWidth: '140px' }}>
                <div style={{ fontSize: '11px', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '4px' }}>Unreviewed</div>
                <div style={{ fontSize: '24px', fontWeight: 700, color: 'var(--success)' }}>0</div>
                <div style={{ fontSize: '11px', color: 'var(--success)' }}>‚úì All done</div>
              </div>
              <div className="card" style={{ flex: 1, padding: '16px', textAlign: 'center', minWidth: '140px' }}>
                <div style={{ fontSize: '11px', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '4px' }}>Pending Triage</div>
                <div style={{ fontSize: '24px', fontWeight: 700, color: totalPending > 0 ? 'var(--high)' : 'var(--success)' }}>{totalPending}</div>
                <div style={{ fontSize: '11px', color: 'var(--text-muted)' }}>{highPending} High priority</div>
              </div>
            </div>
            <div className="card" style={{ padding: '16px', background: 'var(--accent-bg)', border: '1px solid rgba(99,102,241,0.3)' }}>
              <div style={{ fontSize: '14px', fontWeight: 600, marginBottom: '4px' }}>üìã Next Step: Triage Findings</div>
              <div style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                Answer questions in the <strong>Triage</strong> tab, then run the PM command below to create tickets.
              </div>
            </div>
          </div>

          {/* PM Commands */}
          <div className="section">
            <div className="section-title">PM Commands</div>
            <p style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '16px' }}>
              Copy these commands and paste into a <strong>new Cursor chat</strong>. The PM agent will generate batch commands for doc/review agents, or process your triage decisions.
            </p>
            
            <CommandBox label={PM_COMMANDS.processDecisions.label} command={PM_COMMANDS.processDecisions.command} description={PM_COMMANDS.processDecisions.description} />
            <CommandBox label={PM_COMMANDS.continueHighFindings.label} command={PM_COMMANDS.continueHighFindings.command} description={PM_COMMANDS.continueHighFindings.description} />
            <CommandBox label={PM_COMMANDS.docMode.label} command={PM_COMMANDS.docMode.command} description={PM_COMMANDS.docMode.description} />
            <CommandBox label={PM_COMMANDS.reviewMode.label} command={PM_COMMANDS.reviewMode.command} description={PM_COMMANDS.reviewMode.description} />
          </div>

          {/* Workflow */}
          <div className="section">
            <div className="section-title">How It Works</div>
            <div className="card" style={{ padding: '20px' }}>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                  <div style={{ width: '28px', height: '28px', borderRadius: '50%', background: 'var(--success)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', fontWeight: 700, flexShrink: 0 }}>1</div>
                  <div>
                    <div style={{ fontWeight: 600, fontSize: '14px' }}>Doc Sprint</div>
                    <div style={{ fontSize: '12px', color: 'var(--text-muted)' }}>PM generates batch of doc-agent commands ‚Üí You paste each into separate Cursor chats ‚Üí They run in parallel</div>
                  </div>
                </div>
                <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                  <div style={{ width: '28px', height: '28px', borderRadius: '50%', background: 'var(--success)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', fontWeight: 700, flexShrink: 0 }}>2</div>
                  <div>
                    <div style={{ fontWeight: 600, fontSize: '14px' }}>Review Sprint</div>
                    <div style={{ fontSize: '12px', color: 'var(--text-muted)' }}>PM generates batch of review-agent commands ‚Üí Agents find issues ‚Üí Findings written to REVIEW_FINDINGS.md</div>
                  </div>
                </div>
                <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                  <div style={{ width: '28px', height: '28px', borderRadius: '50%', background: 'var(--accent)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', fontWeight: 700, flexShrink: 0 }}>3</div>
                  <div>
                    <div style={{ fontWeight: 600, fontSize: '14px' }}>Triage (This Dashboard)</div>
                    <div style={{ fontSize: '12px', color: 'var(--text-muted)' }}>Answer questions in Triage tab ‚Üí Decisions auto-saved ‚Üí Run PM to create tickets</div>
                  </div>
                </div>
                <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                  <div style={{ width: '28px', height: '28px', borderRadius: '50%', background: 'var(--bg-elevated)', color: 'var(--text-muted)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', fontWeight: 700, flexShrink: 0 }}>4</div>
                  <div>
                    <div style={{ fontWeight: 600, fontSize: '14px' }}>Dev Sprint</div>
                    <div style={{ fontSize: '12px', color: 'var(--text-muted)' }}>PM generates dev-agent commands from tickets ‚Üí Agents implement fixes</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ================= MAIN APP =================

    function App() {
      const [view, setView] = useState('pipeline');
      const [serverMode, setServerMode] = useState(false);
      const [findings, setFindings] = useState([]);
      const [serverDecisions, setServerDecisions] = useState(null);
      const [loading, setLoading] = useState(true);

      // Check if server is running and load data
      useEffect(() => {
        setLoading(true);
        fetch('/api/data')
          .then(res => {
            if (res.ok) {
              setServerMode(true);
              return res.json();
            }
            throw new Error('Server not available');
          })
          .then(data => {
            if (data.findings?.findings) {
              setFindings(data.findings.findings);
              // Update embedded data for other views
              FINDINGS_DATA = data.findings.findings;
            }
            if (data.decisions) {
              setServerDecisions(data.decisions);
            }
            setLoading(false);
          })
          .catch(() => {
            setServerMode(false);
            setLoading(false);
            // Try loading from embedded script or fallback
            console.log('Server not available, using fallback data');
          });
      }, []);

      // Save decisions to server
      const saveDecisions = async (decisions) => {
        const res = await fetch('/api/decisions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(decisions)
        });
        if (!res.ok) throw new Error('Save failed');
      };

      return (
        <div style={{ minHeight: '100vh' }}>
          {/* Header */}
          <header style={{ padding: '24px 40px', borderBottom: '1px solid var(--border-subtle)', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div>
              <h1 style={{ fontSize: '24px', fontWeight: 800, background: 'var(--gradient-hero)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>PM Dashboard</h1>
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginTop: '2px' }}>
                <span style={{ color: 'var(--text-muted)', fontSize: '13px' }}>Digital Greeter ‚Ä¢ {new Date().toLocaleDateString()}</span>
                {serverMode && (
                  <span style={{ fontSize: '11px', padding: '2px 8px', background: 'rgba(16,185,129,0.15)', color: 'var(--success)', borderRadius: '4px' }}>
                    üü¢ Server Connected
                  </span>
                )}
                {!serverMode && !loading && (
                  <span style={{ fontSize: '11px', padding: '2px 8px', background: 'rgba(234,179,8,0.15)', color: 'var(--medium)', borderRadius: '4px' }}>
                    ‚ö†Ô∏è Run server for auto-save
                  </span>
                )}
              </div>
            </div>
            <div className="nav">
              <button className={`nav-item ${view === 'pipeline' ? 'active' : ''}`} onClick={() => setView('pipeline')}>üìä Pipeline</button>
              <button className={`nav-item ${view === 'triage' ? 'active' : ''}`} onClick={() => setView('triage')}>üìã Triage</button>
              <button className={`nav-item ${view === 'tickets' ? 'active' : ''}`} onClick={() => setView('tickets')}>üé´ Tickets</button>
              <button className={`nav-item ${view === 'agents' ? 'active' : ''}`} onClick={() => setView('agents')}>üöÄ Agents</button>
            </div>
          </header>

          {/* Main Content */}
          <main style={{ padding: '32px 40px' }}>
            {loading ? (
              <div className="card" style={{ textAlign: 'center', padding: '60px' }}>
                <div style={{ fontSize: '24px', marginBottom: '12px' }}>‚ü≥</div>
                <div style={{ color: 'var(--text-muted)' }}>Loading findings...</div>
              </div>
            ) : (
              <>
                {view === 'pipeline' && <PipelineView />}
                {view === 'triage' && <TriageView serverMode={serverMode} onSave={saveDecisions} findingsData={findings} serverDecisions={serverDecisions} />}
                {view === 'tickets' && <TicketsView />}
                {view === 'agents' && <AgentsView />}
              </>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
